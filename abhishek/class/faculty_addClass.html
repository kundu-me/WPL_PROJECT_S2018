<!--
    @author: Abhishek Datta <abhi06548@yahoo.com>
    @page: Faculty-Add new class UI
    @description: This page handles the addition of new course and generation of class OTP by faculty
-->

<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="UTF-8">
		<title>Add Class Interface</title>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<script>

	//function to reset input and focus on first field on every page refrssh
    function  resetInput() {
		jQuery("#CourseID").focus();
    }
	
	//function to disable form-elements on Create-Class button click
	function formDisable() {
		jQuery("#CourseID").attr("disabled", true); 
		jQuery("#CourseID").addClass("btnDisable");
		
		jQuery("#CourseName").attr("disabled", true); 
		jQuery("#CourseName").addClass("btnDisable");
		
		jQuery("#session").attr("disabled", true);
		jQuery("#session").addClass("btnDisable");
		
		jQuery("#year").attr("disabled", true); 
		jQuery("#year").addClass("btnDisable");
		
		jQuery("#classRoster").attr("disabled", true); 
		jQuery("#classRoster").addClass("btnDisable");
		
		jQuery("#otp_generate").attr("disabled", true); 	
		jQuery("#otp_generate").addClass("btnDisable");
		
		jQuery("#generateOTP").attr("disabled", true); 
		jQuery("#generateOTP").addClass("btnDisable");
		
		
		jQuery("#btnSubmit").attr("disabled", true); 	
		jQuery("#btnSubmit").addClass("btnDisable");
	}


    jQuery(document).ready(function () {

        resetInput();
		jQuery(".container:last").hide(); //hide the last div displaying generated OTP when the form loads
		
		//function executed when generateOTP button clicked------------------------------------
		jQuery("#generateOTP").click(function (event) {
			event.preventDefault();
			jQuery("#otp_generate").val(Math.floor(Math.random()*9000) + 1000);
		});
		
		//function executed when (Create new class) submit button clicked ----------------------------
        jQuery("#btnSubmit").click(function (e1) {
			e1.preventDefault();
			jQuery("#lblSuccess").text("");

            var courseID = jQuery("#CourseID").val();
            var courseName = jQuery("#CourseName").val();
			var otpGen = jQuery("#otp_generate").val();

			//form validation failure routine----------------------------------------------------------------------------------
            if((courseID == "" || courseID.length == 0) || (courseName == "" || courseName.length == 0) || 
				(!$('#session').val()) || (otpGen == "" || otpGen.length == 0 || otpGen.length > 4)) {

                jQuery("#lblSuccess").text("Provide values in mandatory fields: Course ID, Name, Session and OTP-only 4 digits");
                jQuery("#divSuccess").addClass("failure-msg");

                if(courseID == "" || courseID.length == 0) {
                    jQuery("#CourseID").focus();
                }
                else if(courseName == "" || courseName.length == 0) {
                    jQuery("#CourseName").focus();
                }
				else if(!$('#session').val()) {
                    jQuery("#session").focus();
                }
				else if(otpGen == "" || otpGen.length == 0) {
                    jQuery("#otp_generate").focus();
                }
	
				return;
            }
			//form validation failure routine ends--------------------------------------------------------------------------------
            
			if(jQuery("#divSuccess").hasClass("failure-msg")) {
                jQuery("#divSuccess").removeClass("failure-msg");
            }
			
			formDisable(); //disable form elements on successful form validation and submission
			$("#results").text($('#formData').serialize());
			
			//Show last div for OTP generation when form is validated, and copy the OTP text//
			jQuery(".container:last").show();
			jQuery("#courseID-1").text(courseID); 
			jQuery("#courseTerm-1").text(jQuery("#session").val() + " "+ jQuery("#year").val());
			jQuery("#otp").val(otpGen);
	

        });
		
		//Copy button click functionality ------------------------------------
		jQuery("#btnCopy").click(function () {
			value1 = jQuery("#instructions").text();
			value2 = jQuery("#otp").val();
			var $temp = $("<input>");
			$("body").append($temp);
			$temp.val(value1 + " - " + value2).select();
			document.execCommand("copy");
			$temp.remove();
		});
		
		//Close button click functionality that takes to previous page URL----------------
		jQuery("#btnClose").click(function () {
			self.location = "https://www.google.com";
		});

    });
	</script>

	<style>
		.text-align-right {
			text-align: right;
		}

		.failure-msg {
			font-size: 24px;
			font-style: italic;
			color: red;
		}
	
		select:invalid { 
			color: gray; 
		}

		#generateOTP, #btnSubmit, #btnCopy, #btnClose {
			padding: 0px 4px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			border-radius: 8px;		
			cursor: pointer;
			margin: 0px 2px;
		}
	
		.btnDisable {
			color: gray;
			cursor: not-allowed;
		}
	</style>
</head>

<body>
	 <form id= "formData" action="/action_page.php" method="post"> 
	 
		<div class="container">
            <div class="row">
                <div class="col-lg-12 col-lg-12">
                    <h2><i>FACULTY - Add New Class</i></h2>
                </div>
            </div>

            <br>
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Course Code & Section*</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="CourseID" name="Course ID" placeholder ="eg: CS 6001.001" class="col-lg-6" autocomplete="off"></h3>
                </div>
            </div>


            <div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Course Name*</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="CourseName" name="Course Name" class="col-lg-6" autocomplete="off"><h3>
                </div>
            </div>

			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Academic Session</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
					 <h3><select id="session" name="Session" class="col-lg-6" required autocomplete="off">
						<option value="" disabled selected hidden>Choose a term..</option>
						<option value="Fall">Fall</option>
						<option value="Spring">Spring</option>
						<option value="Summer">Summer</option>
					</select></h3>
                </div>
            </div>
			
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Academic Year</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><select id="year" name="Year" class="col-lg-6" autocomplete="off">
						<option value="2018" selected>2018</option>
						<option value="2019">2019</option>
					</select></h3>
                </div>
            </div>
			
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Class Roster (.xls only)</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="file" id="classRoster" name="class_roster" accept=".xls" autocomplete="off"></h3>
                </div>
            </div>
			
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>OTP (4-digit code)*</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="otp_generate" name="OTP" placeholder ="eg: 1234" class="col-lg-6" autocomplete="off"></h3>
					<h3><button id="generateOTP">Generate OTP</button></h3>
                </div>
            </div>

            <br>
            <div class="row">
                <div class="col-lg-12 col-lg-3">
                </div>
                <div class="col-lg-12 col-lg-6">
                    <h3><input type="submit" value="Create New Class" id="btnSubmit" class="col-lg-6"></h3>
                </div>
                <div class="col-lg-12 col-lg-3">
                </div>
            </div>
		</div>
	</form> 


    <div class="container"><!--Div element to show failure message for form validation -->
            <div class="row">
                <div class="col-lg-12 col-lg-3">
                </div>
                <div id="divSuccess" class="col-lg-12 col-lg-9">
                    <p>
                        <label id="lblSuccess"></label>
                    </p>
                </div>
            </div>
    </div>

	<br>
    <div class="container"> <!--Dynamic population of div element on button click -->
            <div class="row">
				<h4><p id="instructions" class="col-lg-12">Please use the provided One-time Password for signing into <span id="courseID-1"></span>
					course for <span id="courseTerm-1"></span>.</p></h4>
				<div id="divOTP" class="col-lg-12 col-lg-3">
					<h3><input type="text" id="otp" name="One-time Pwd" value="" class="col-lg-12" disabled autocomplete="off"></h3>
				</div>
				<div class="col-lg-12 col-lg-2">
					<h3><button id="btnCopy">Copy</button></h3>
				</div>
				<div class="col-lg-12 col-lg-7">
					<h3><button id="btnClose">Close</button></h3>
				</div>
            </div>
    </div>
</body>
</html>