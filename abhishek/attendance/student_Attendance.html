<!--
    @author: Abhishek Datta <abhi06548@yahoo.com>
    @page: Student-New Attendance UI
    @description: This page will display as lightbox when clicked attendance button from profile header.
				  This page handles the submission of daily attendance by the student (based on OTP provided by faculty)
-->

<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="UTF-8">
		<title>Post New Attendance Interface</title>

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<script>

	//function to reset input and focus on first field on every page refrssh
    function  resetInput() {
		jQuery("#CourseID").focus();
    }
	
	//function to disable form-elements on Create-Class button click
	function formDisable() {
		
		jQuery("#CourseID").attr("disabled", true); 
		jQuery("#CourseID").addClass("btnDisable");

		jQuery("#otp_received").attr("disabled", true); 	
		jQuery("#otp_received").addClass("btnDisable");
	}


    jQuery(document).ready(function () {
        resetInput();
		jQuery("table.container").hide(); //hide the table element displaying fetched course details based on OTP provided
		jQuery("div.container:last").hide(); //hide the div element for OTP intake and submit

		
		//function executed when Course ID selected from drop-down ----------------------------
        jQuery('#CourseID').on('change', function() {
			if ( this.value == "") {
				jQuery("table.container").hide(); //hide the table element displaying fetched course details based on OTP provided
				jQuery("div.container:last").hide();
			}
			else {
				jQuery("#lblSuccess").text("");
				var CourseID = jQuery("#CourseID").val();
				var date=new Date();
				jQuery("#date").val(date); //generate local datetime

				jQuery("table.container").show(); //Show table element with course details, when any course ID selected from list//
				jQuery("div.container:last").show(); //Show div element for OTP inout by student for post attendance //
				jQuery("#date_dd_mm_yyyy").text(date.getDate() + "/"+ (date.getMonth()+1) +"/"+ date.getFullYear());
			}
		});
		
	
		//OTP Submit button click functionality ------------------------------------
		jQuery("#btnSubmit").click(function (e1) {
			e1.preventDefault();
			jQuery("#lblSuccess").text("");
			var otp = jQuery("#otp_received").val();

			//OTP validation failure routine----------------------------------------------------------------------------------
            if(otp == "" || otp.length == 0 || otp.length > 4) {

                jQuery("#lblSuccess").text("Provide value in mandatory field OTP ( 4 digits only)");
                jQuery("#divSuccess").addClass("failure-msg");
				jQuery("#otp_received").focus();
	
				return;
            }
			else if (otp != "0101") {   //OTP provided is not valid as per OTP present in database against the course attendance for the day			
				jQuery("#lblSuccess").text("OTP not valid for attendance. Please recheck OTP from email!!");
                jQuery("#divSuccess").addClass("failure-msg");
				
				jQuery("#otp_received").val("");
				jQuery("#otp_received").focus();
				
				return;
			} 
			
			//OTP validation failure routine ends--------------------------------------------------------------------------------

			if(jQuery("#divSuccess").hasClass("failure-msg")) {
                jQuery("#divSuccess").removeClass("failure-msg");
            }

			formDisable(); //disable input section on successful OTP validation and submission

			//form post......................//
		});
		
    });
	</script>

	<style>
		.text-align-right {
			text-align: right;
		}

		.failure-msg {
			font-size: 24px;
			font-style: italic;
			color: red;
		}
	
		select:invalid { 
			color: gray; 
		}

		#btnSubmit {
			padding: 0px 4px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			border-radius: 8px;		
			cursor: pointer;
			margin: 0px 10px;
		}
	
		.btnDisable {
			color: gray;
			cursor: not-allowed;
		}
		
		table {
			width: 100%;
		}
		
		tr {
			width: 100%;
			height: 60px;
		}
	
	</style>
</head>

<body>
	 
	<div class="container"> <!--Div element to enter the OTP provided by faculty and verify course detail -->
            <div class="row">
                <div class="col-lg-12 col-lg-12">
                    <h2><i>STUDENT - Post Attendance</i></h2>
                </div>
            </div>
			
            <br>
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Course-ID</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><select id="CourseID" name="Course ID" class="col-lg-6" required autocomplete="off">
						<option value=""  selected >Select from the list..</option>
						<option value="CS6301.001">CS6301.001</option>
						<option value="CS6305.002">CS6305.002</option>
					</select></h3>
                </div>
            </div>
    </div> 
	 
	<form id= "formData"> 
		<table class="container">
		
            <tr class="row">
                <td class="col-lg-12 col-lg-3">
                    <h3>Course Name</h3>
                </td>
                <td class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="CourseName" name="Course Name" class="col-lg-6" disabled="disabled" autocomplete="off"><h3>
                </td>
            </tr>

			<tr class="row">
                <td class="col-lg-12 col-lg-3">
                    <h3>Academic Session</h3>
                </td>
                <td class="col-lg-12 col-lg-9">
					 <h3><input type="text" id="session" name="Session" class="col-lg-6" disabled="disabled" autocomplete="off"></h3>
                </td>
            </tr>
			
			<tr class="row">
                <td class="col-lg-12 col-lg-3">
                    <h3>Academic Year</h3>
                </td>
                <td class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="year" name="Year" class="col-lg-6" disabled="disabled" autocomplete="off"></h3>
                </td>
            </tr>
			
			<tr class="row">
                <td class="col-lg-12 col-lg-3">
                    <h3>Attendance Date</h3>
                </td>
                <td class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="date" name="Date" class="col-lg-6" disabled="disabled" autocomplete="off"></h3>
                </td>
            </tr>
 
		</table>
	</form> 
	
	<br>
	<div class="container"> <!--Div element to enter the OTP provided by faculty and verify course detail -->
			<div class="row">
				<div class="col-lg-12 col-lg-2">
                </div>
				<div class="col-lg-12 col-lg-10">
					<h4><p id="instructions" class="col-lg-10">Provide proper OTP received in mail to post attendance for date:
						<span id="date_dd_mm_yyyy"></span></p></h4>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12 col-lg-3">
                </div>
				<div class="col-lg-12 col-lg-2">
                    <h3><input type="text" id="otp_received" name="OTP" placeholder ="eg: 1234" class="col-lg-10" autocomplete="off"></h3>
                </div>
				<div class="col-lg-12 col-lg-3">
					<h3><input type="submit" value="Submit" id="btnSubmit" class="col-lg-6"></h3>
                </div>
            </div>
			
			<br>
			<div class="row">
                <div id="divSuccess" class="col-lg-12 col-lg-9">
                    <p>
                        <label id="lblSuccess"></label>
                    </p>
                </div>
            </div>
    </div> 

</body>
</html>