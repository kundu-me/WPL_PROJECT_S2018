<!--
    @author: Abhishek Datta <abhi06548@yahoo.com>
    @page: Faculty-Create Attendance UI
    @description: This page handles the creation of daily attendance sheet and OTP-generation (for student use) by faculty
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Class Attendance</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>

    function  resetInput() {
		jQuery("#CourseID").focus();
    }
	
	function formDisable() {
		jQuery("#CourseID").attr("disabled", true); 
		jQuery("#CourseID").addClass("btnDisable");
		
		jQuery("#date").attr("disabled", true); 
		jQuery("#date").addClass("btnDisable");
		
		jQuery("#otp_generate").attr("disabled", true); 	
		jQuery("#otp_generate").addClass("btnDisable");
		
		jQuery("#generateOTP").attr("disabled", true); 
		jQuery("#generateOTP").addClass("btnDisable");
		
		jQuery("#btnSubmit").attr("disabled", true); 	
		jQuery("#btnSubmit").addClass("btnDisable");
	}


    jQuery(document).ready(function () {

        resetInput();
		jQuery("#closeAttn").hide();
		jQuery("div.container:last").hide();
		jQuery("table.container").hide();
		jQuery("#btnExport").hide();
		
		var date=new Date();
		jQuery("#date").val(date);
		
		jQuery("#generateOTP").click(function (event) {
			event.preventDefault();
			jQuery("#otp_generate").val(Math.floor(Math.random()*9000) + 1000);
		});
		
        jQuery("#btnSubmit").click(function (e1) {
			e1.preventDefault();
			jQuery("#lblSuccess").text("");

			var courseID = jQuery("#CourseID").val();
			var otpGen = jQuery("#otp_generate").val();

            if((!$('#CourseID').val()) || (otpGen == "" || otpGen.length == 0 || otpGen.length > 4)) {

                jQuery("#lblSuccess").text("Provide/generate value in mandatory field CourseID and OTP - 4 digit only ");
                jQuery("#divSuccess").addClass("failure-msg");

				if(!$('#CourseID').val()) {
                    jQuery("#CourseID").focus();
                }
				else if(otpGen == "" || otpGen.length == 0) {
                    jQuery("#otp_generate").focus();
                }
	
				return;
            }
            
			if(jQuery("#divSuccess").hasClass("failure-msg")) {
                jQuery("#divSuccess").removeClass("failure-msg");
            }
			
			formDisable(); //disable form elements on successful form submission
			
			//Show last div for OTP generation when form validated and copy //
			jQuery("#closeAttn").show();
			jQuery("div.container:last").show();
			jQuery("#courseID-1").text(courseID); 
			jQuery("#date_dd_mm_yyyy").text(date.getDate() + "/"+ (date.getMonth()+1) +"/"+ date.getFullYear());
			jQuery("#otp").val(otpGen);
			
			//create attendance table dynamically
			jQuery("table.container").show();
			$('html, body').animate({
					scrollTop: $("table.container").offset().top
			}, 2000);				

        });
				
		jQuery("#close_attnd").click(function (e2) {
			e2.preventDefault();
			var r = confirm("Do you really wish to close attendance now!!");
			if (r == true) {
				jQuery("#timer").attr("disabled", true); 
				jQuery("#timer").addClass("btnDisable");			

				jQuery("#closeAttn").attr("disabled", true); 
				jQuery("#closeAttn").addClass("btnDisable");
				
				jQuery("#btnCopy").attr("disabled", true); 
				jQuery("#btnCopy").addClass("btnDisable");
				
				jQuery("#btnExport").show();
				$('html, body').animate({
						scrollTop: $("#btnExport").offset().top
				}, 2000);
			}

		});

		
		jQuery("#btnCopy").click(function () {
			value1 = jQuery("#instructions").text();
			value2 = jQuery("#otp").val();
			var $temp = $("<input>");
			$("body").append($temp);
			$temp.val(value1 + " - " + value2).select();
			document.execCommand("copy");
			$temp.remove();
		});
		
		jQuery("#btnClose").click(function () {
			self.location = "https://www.google.com";
		});

    });
</script>

<style>
    .text-align-right {
        text-align: right;
    }

    .failure-msg {
        font-size: 24px;
        font-style: italic;
        color: red;
    }
	
	select:invalid { 
		color: gray; 
	}

	#generateOTP, #btnSubmit, #close_attnd, #btnCopy, #btnClose, #btnExport {
		padding: 0px 5px;
		text-align: center;
		text-decoration: none;
		display: inline-block;
		border-radius: 8px;		
		cursor: pointer;
		margin: 0px 2px;
	}
	
	.btnDisable {
		color: gray;
		cursor: not-allowed;
	}
	
	table {
		border-collapse: collapse;
		width: 100%;
		height: 1000px;

	}
	table, th, td {
		border: 1px solid black;
		width: 100%;
		height: 50px;
		text-align: center;
	}
	
	th, td {
		border-bottom: 1px solid #ddd;
	}
</style>
</head>

<body>
	 <form id= "formData"> 
	 
		<div class="container">
            <div class="row">
                <div class="col-lg-12 col-lg-12">
                    <h2><i>FACULTY - Add Class Attendance</i></h2>
                </div>
            </div>

            <br>
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Course Code & Section</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><select id="CourseID" name="Course ID" class="col-lg-6" required autocomplete="off">
						<option value="" disabled selected hidden>Select from course list..</option>
						<option value="CS6301.001">CS6301.001</option>
						<option value="CS6305.002">CS6305.002</option>
					</select></h3>
                </div>
            </div>


            <div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Course Name*</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="CourseName" name="Course Name" class="col-lg-6" disabled="disabled" autocomplete="off"><h3>
                </div>
            </div>

			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Academic Session</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
					 <h3><input type="text" id="session" name="Session" class="col-lg-6" disabled="disabled" autocomplete="off"></h3>
                </div>
            </div>
			
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Academic Year</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="year" name="Year" class="col-lg-6" disabled="disabled" autocomplete="off"></h3>
                </div>
            </div>
			
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>Attendance for</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="date" name="Date" class="col-lg-6" disabled="disabled" autocomplete="off"></h3>
                </div>
            </div>
			
			<div class="row">
                <div class="col-lg-12 col-lg-3">
                    <h3>OTP (4-digit code)*</h3>
                </div>
                <div class="col-lg-12 col-lg-9">
                    <h3><input type="text" id="otp_generate" name="OTP" placeholder ="eg: 1234" class="col-lg-6" autocomplete="off"></h3>
					<h3><button id="generateOTP">Generate OTP</button></h3>
                </div>
            </div>

            <br>
            <div class="row">
                <div class="col-lg-12 col-lg-1">
					<h3>Timer</h3>
				</div>
				<div class="col-lg-12 col-lg-2">
					<h3><select id="timer" name="Timer" autocomplete="off">
						<option value=1 selected>15 mins</option>
						<option value=2>30 mins</option>
						<option value=3>45 mins</option>
					</select></h3>
                </div>
                <div class="col-lg-12 col-lg-4">
                    <h3><input type="submit" value="Open Attendance" id="btnSubmit"></h3>
                </div>
                <div id="closeAttn" class="col-lg-12 col-lg-5">
                    <h3><input type="submit" value="Close Attendance" id="close_attnd"></h3>
                </div>
            </div>
		</div>
	</form> 

    <div class="container">
            <div class="row">
                <div class="col-lg-12 col-lg-3">
                </div>
                <div id="divSuccess" class="col-lg-12 col-lg-9">
                    <p>
                        <label id="lblSuccess"></label>
                    </p>
                </div>
            </div>
    </div>
	
	<br>
    <div class="container"> <!--Dynamic population of div element on button click -->
            <div class="row">
				<h4><p id="instructions" class="col-lg-12">Please use this One-time Password to give attendance on <span id="courseID-1"></span>
					course for the date: <span id="date_dd_mm_yyyy"></span></p></h4>
				<div id="divOTP" class="col-lg-12 col-lg-3">
					<h3><input type="text" id="otp" name="One-time Pwd" value="" class="col-lg-12" disabled autocomplete="off"></h3>
				</div>
				<div class="col-lg-12 col-lg-2">
					<h3><button id="btnCopy">Copy</button></h3>
				</div>
				<div class="col-lg-12 col-lg-7">
					<h3><button id="btnClose">Close</button></h3>
				</div>
            </div>
    </div>
	
	<br>
	<table class="container"> <!--Dynamic population of div element on button click -->
		<th class="row">
			<h3 id="attnTable" class="col-lg-12">Attendance Data-sheet below</h3>
		</th>
    </table>
	
	<div class="col-lg-12 col-lg-3">
		<h3><button id="btnExport">Export</button></h3>
	</div>
	
</body>
</html>